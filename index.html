<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§® Ù†Ø¸Ø§Ù… Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ©</title>

    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #0056b3; 
            --secondary-color: #007bff; 
            --background-light: #f5f8fa;
            --background-card: #ffffff;
            --text-dark: #212529;
            --text-light: #ffffff;
            --reset-color: #dc3545;
            --warning-color: #ffc107;
            --print-color: #28a745;
        }

        body {
            font-family: 'Rubik', sans-serif;
            background: var(--background-light);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
            direction: rtl; 
        }

        .container {
            max-width: 960px;
            margin: 30px auto;
            background: var(--background-card);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 60px);
            position: relative;
            padding-bottom: 80px;
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            display: block;
        }

        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 14px;
            font-size: 17px;
            border-radius: 10px;
            border: 1px solid #ced4da;
            background: #f8f9fa;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
            background: var(--background-card);
            outline: none;
        }

        .hidden {
            display: none !important;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            flex-grow: 1;
            padding: 16px;
            border-radius: 10px;
            border: none;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button i {
            margin-left: 10px;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        #calculateBtn {
            background: var(--primary-color);
            color: var(--text-light);
        }
        #calculateBtn:hover {
            background: #004599;
            transform: translateY(-2px);
        }

        #resetBtn {
            background: var(--reset-color);
            color: var(--text-light);
        }
        #resetBtn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        #printBtn {
            background: var(--print-color);
            color: var(--text-light);
        }
        #printBtn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .result-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .result {
            margin-bottom: 15px;
            padding: 15px;
            background: #e9f5ff;
            border-left: 5px solid var(--secondary-color);
            border-radius: 8px;
            font-size: 18px; 
            font-weight: 500;
            color: var(--primary-color);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ±Ù‚ÙŠØ© */
        .promo-result {
            background: #e6ffec; 
            border-left: 5px solid var(--print-color); 
            color: #155724; 
        }
        
        .promo-result span {
            font-weight: 700;
            color: var(--print-color);
        }


        .warning {
            margin-top: 15px;
            padding: 15px;
            background: #fff3cd;
            border-left: 5px solid var(--warning-color);
            border-radius: 8px;
            font-size: 17px; 
            font-weight: 600;
            color: #856404;
        }

        .details {
            margin-top: 25px;
            padding: 20px;
            background: #f8fafd;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            font-size: 16px; 
            color: var(--text-dark);
            line-height: 1.8;
        }

        .details strong {
            color: var(--primary-color);
            font-weight: 700;
        }

        .details span {
            font-family: 'Rubik', sans-serif;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .promo-list {
            margin-top: 10px;
            padding-right: 0;
            list-style: none;
        }
        .promo-list li {
            padding: 5px 0 5px 10px;
            border-bottom: 1px dotted #ccc;
            font-size: 16px;
        }
        .promo-list li:last-child {
            border-bottom: none;
        }
        
        /* === Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨ÙØ±Ø¶ Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„ÙŠÙ…ÙŠÙ† ÙÙŠ PDF === */
        .details ul {
            direction: rtl; 
            text-align: right;
            padding-right: 25px; 
            list-style-position: outside; 
            list-style-type: disc; 
        }

        .details li {
            text-align: right;
            direction: rtl;
            padding-right: 0; 
            margin-right: 0;
        }
        /* ======================================================= */

        /* ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
        .footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 35px;
            margin-top: 40px;
            border-top: 2px solid #000;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            background: transparent;
        }

        .footer p {
            margin: 0;
            padding: 0;
        }

        .footer hr {
            border: none;
            border-top: 1px solid #000;
            margin: 0 0 15px 0;
        }

        @media (max-width: 768px) {
            .container { margin: 15px; padding: 25px; padding-bottom: 70px; border-radius: 15px; }
            h2 { font-size: 28px; margin-bottom: 20px; }
            .btn-group { flex-direction: column; gap: 10px; }
            button { font-size: 17px; padding: 14px; }
            .result { font-size: 17px; padding: 14px; }
            .details { font-size: 15px; padding: 15px; }
            .footer { padding: 15px 25px; }
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© ÙƒØ§Ø­ØªÙŠØ§Ø·ÙŠ */
        @media print {
            body { background: white; }
            .container { 
                box-shadow: none; 
                margin: 0; 
                padding: 0;
                max-width: 100%;
            }
            .form-group, .btn-group, h2 { display: none !important; }
            .result-section { border-top: none; padding-top: 0; }
            .result, .warning, .details {
                page-break-inside: avoid;
                border: 1px solid #333 !important;
                background: #f9f9f9 !important;
                padding: 10px !important;
                margin-bottom: 10px !important;
            }
            .details ul { 
                padding-right: 25px !important; 
                direction: rtl !important; 
                text-align: right !important;
                list-style-position: outside !important;
            }
            .details li {
                direction: rtl !important; 
                text-align: right !important;
            }
            .promo-list { list-style: none; padding-right: 0; }
            .footer { 
                display: block !important;
                position: relative !important;
                border-top: 2px solid #000 !important;
                padding: 15px !important;
                margin-top: 20px !important;
            }
        }
    </style>
</head>
<body>

<div class="container">

    <h2><i class="fas fa-calculator"></i> Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ©</h2>

    <form id="salaryForm">
        <div class="form-group">
            <label for="degreeType">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</label>
            <select id="degreeType" name="degreeType">
                <option value="diploma">Ø¯Ø¨Ù„ÙˆÙ…</option>
                <option value="bachelor" selected>Ø¨ÙƒÙ„ÙˆØ±ÙŠÙˆØ³</option>
                <option value="master">Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                <option value="phd">Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="workType">ØªØµÙ†ÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙØ©</label>
            <select id="workType" name="workType">
                <option value="field" selected>Ù…ÙŠØ¯Ø§Ù†ÙŠ</option>
                <option value="admin">Ø¥Ø¯Ø§Ø±ÙŠ</option>
            </select>
        </div>

        <div class="form-group">
            <label for="grade">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
            <select id="grade" name="grade">
                <option value="8" selected>8</option>
                <option value="7">7</option>
                <option value="6">6</option>
                <option value="5">5</option>
                <option value="4">4</option>
                <option value="3">3</option>
                <option value="2">2</option>
                <option value="1">1</option>
            </select>
        </div>

        <div class="form-group">
            <label for="stage">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
            <select id="stage" name="stage">
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
            </select>
        </div>

        <div class="form-group">
            <label for="locationAllowance">Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ / Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© (Ø¯ÙŠÙ†Ø§Ø±)</label>
            <input type="number" id="locationAllowance" name="locationAllowance" value="50000" min="0">
        </div>

        <div class="form-group">
            <label for="lastPromotion">ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ±Ù‚ÙŠØ©</label>
            <input type="date" id="lastPromotion" name="lastPromotion">
        </div>

        <div class="form-group">
            <label for="promotionType">Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ù‚ÙŠØ©</label>
            <select id="promotionType" name="promotionType">
                <option value="normal" selected>ØºÙŠØ± Ù…Ø´Ù…ÙˆÙ„ Ø¨Ø§Ù„ØªØ³Ø±ÙŠØ¹ (ØªØ±Ù‚ÙŠØ© Ø¹Ø§Ø¯ÙŠØ©)</option>
                <option value="fast">Ù…Ø´Ù…ÙˆÙ„ Ø¨Ø§Ù„ØªØ³Ø±ÙŠØ¹ (ØªØ§Ø±ÙŠØ® ØªØ®Ø±Ø¬)</option>
            </select>
        </div>

        <div id="gradBox" class="form-group hidden">
            <label for="gradDate">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ®Ø±Ø¬</label>
            <input type="date" id="gradDate" name="gradDate">
        </div>

        <div class="form-group">
            <label for="social">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</label>
            <select id="social" name="social">
                <option value="single" selected>Ø£Ø¹Ø²Ø¨</option>
                <option value="married">Ù…ØªØ²ÙˆØ¬</option>
            </select>
        </div>

        <div id="kidsBox" class="form-group hidden">
            <label for="kids">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„</label>
            <select id="kids" name="kids">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>

        <div class="form-group">
            <label for="bonusMonths">Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„Ù‚Ø¯Ù… (ÙƒØªØ¨ Ø§Ù„Ø´ÙƒØ±)</label>
            <input type="number" id="bonusMonths" name="bonusMonths" value="0" min="0">
        </div>

        <div class="btn-group">
            <button type="button" id="calculateBtn"><i class="fas fa-hand-holding-usd"></i> Ø§Ø­Ø³Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button type="button" id="resetBtn"><i class="fas fa-redo-alt"></i> ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
            <button type="button" id="printBtn"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©/Ø­ÙØ¸ PDF</button>
        </div>
    </form>

    <div class="result-section">
        <div id="salaryResult" class="result hidden"></div>
        <div id="promoResult" class="result hidden"></div>
        <div id="newGradeStage" class="result hidden"></div>
        <div id="dueDate" class="result hidden"></div>
        <div id="overdueWarning" class="warning hidden"></div> 
        <div id="newSalaryResult" class="result promo-result" style="display: none;"></div> 
        <div id="detailsBox" class="details hidden"></div>
    </div>

    <div class="footer">
        <hr>
        <p>Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… - Ù…Ø§Ù„Ùƒ Ù…Ø­Ù…Ø¯ - Ø´Ø±ÙƒØ© Ù…ØµØ§ÙÙŠ Ø§Ù„Ø¬Ù†ÙˆØ¨</p>
    </div>

</div>

<script>
    // Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø±Ø§ØªØ¨
    const gradeBase = { 8: 260000, 7: 296000, 6: 362000, 5: 429000, 4: 509000, 3: 600000, 2: 723000, 1: 910000 };
    const stageAddLogic = (grade) => {
        const defaultAdd = { 8: 3000, 7: 6000, 6: 6000, 5: 6000, 4: 8000, 3: 10000, 2: 17000, 1: 20000 };
        return defaultAdd[grade] || 0;
    };
    
    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø£ÙŠ Ø¯Ø±Ø¬Ø© ÙˆÙ…Ø±Ø­Ù„Ø© Ù…Ø­Ø¯Ø¯Ø©
    function calculateFullSalary(targetGrade, targetStage, degree, workType, locationAllowance, social, kids) {
        // 1. Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø§Ø³Ù…ÙŠ
        const nominal = gradeBase[targetGrade] + ((targetStage - 1) * stageAddLogic(targetGrade));

        // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
        let certFactor;
        switch (degree) {
            case 'diploma': certFactor = 0.35; break;
            case 'bachelor': certFactor = 0.45; break;
            case 'master': certFactor = 0.65; break;
            case 'phd': certFactor = 0.75; break;
            default: certFactor = 0;
        }

        const riskFactor = workType === 'field' ? 0.3 : 0.25;
        
        let conditionalFactor = 0; 
        
        if (degree !== 'diploma') {
            conditionalFactor = workType === 'field' ? 0.50 : 0.35;
        }
        
        const fixedOtherAllowanceFactor = 0.3; 

        const totalFactors = certFactor + riskFactor + conditionalFactor + fixedOtherAllowanceFactor;
        const factoredAllowance = nominal * totalFactors; 

        // 3. Ù…Ø®ØµØµØ§Øª Ø§Ù„Ø²ÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„
        let familyAllowance = 0;
        if (social === "married") {
            familyAllowance = 50000 + kids * 10000; 
        }
        
        // 4. Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹Ø§Øª
        const retirement = 0.1 * nominal;
        const fixedDeductions = 25000 + 4000;
        const totalDeductions = retirement + fixedDeductions;
        
        // 5. Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ
        const totalSalary = (nominal + factoredAllowance + locationAllowance + familyAllowance) - totalDeductions;
        
        return { nominal, totalSalary };
    }


    // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„
    function toggleKids() {
        document.getElementById("kidsBox").classList.toggle(
            "hidden",
            document.getElementById("social").value !== "married"
        );
    }

    function toggleGradDate() {
        document.getElementById("gradBox").classList.toggle(
            "hidden",
            document.getElementById("promotionType").value !== "fast"
        );
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
    function formatDate(date) {
        return date.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    function calculateAll() {
        // Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ø®ÙØ§Ø¡
        document.querySelectorAll('.result').forEach(el => el.classList.add('hidden'));
        document.getElementById("detailsBox").classList.add('hidden');
        document.getElementById("overdueWarning").classList.add('hidden'); 
        
        // Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø³Ø±ÙŠ Ù„Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ style Ù…Ø¨Ø§Ø´Ø±Ø©
        document.getElementById("newSalaryResult").style.display = 'none';

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        const grade = parseInt(document.getElementById("grade").value);
        const stage = parseInt(document.getElementById("stage").value);
        const degree = document.getElementById("degreeType").value; 
        const workType = document.getElementById("workType").value;   
        const locationAllowance = parseInt(document.getElementById("locationAllowance").value) || 0; 
        const social = document.getElementById("social").value;
        const kids = parseInt(document.getElementById("kids").value) || 0;
        const promoType = document.getElementById("promotionType").value;
        const lastPromo = document.getElementById("lastPromotion").value ? new Date(document.getElementById("lastPromotion").value) : null;
        const bonusMonths = parseInt(document.getElementById("bonusMonths").value) || 0;
        const now = new Date();


        // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
        const { nominal: currentNominal, totalSalary: currentTotalSalary } = 
            calculateFullSalary(grade, stage, degree, workType, locationAllowance, social, kids);


        // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ù‚ÙŠØ© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚
        let newGrade = grade;
        let promotionDetails = "";
        let dueDate = null;
        let promoHistoryHTML = "";
        let newNominal = 0;
        let newTotalSalary = 0;

        if (promoType === "fast") {
            const gradDateInput = document.getElementById("gradDate").value;
            if (!gradDateInput) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ®Ø±Ø¬ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ³Ø±ÙŠØ¹.");
                return;
            }
            const gradDate = new Date(gradDateInput);
            
            let monthsFromGrad = (now.getFullYear() - gradDate.getFullYear()) * 12 + (now.getMonth() - gradDate.getMonth());
            if (now.getDate() < gradDate.getDate()) monthsFromGrad--;
            
            const promotionsCount = Math.floor(monthsFromGrad / 24);
            const targetGrade = grade - promotionsCount;
            newGrade = targetGrade >= 1 ? targetGrade : 1;
            
            // Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ØªÙƒÙˆÙ† Ø¨Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1
            const newStage = 1; 

            promotionDetails = "Ø¹Ø¯Ø¯ Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© Ø¨Ø§Ù„ØªØ³Ø±ÙŠØ¹ (Ø¯Ø±Ø¬Ø© Ù„ÙƒÙ„ Ø³Ù†ØªÙŠÙ†): <strong>" + promotionsCount + "</strong>";

            let missedPromotions = [];
            let lastPromoDue = null;
            
            for (let i = 0; i < promotionsCount; i++) {
                let promoDate = new Date(gradDate);
                promoDate.setMonth(promoDate.getMonth() + (i + 1) * 24);
                missedPromotions.push(promoDate);
                lastPromoDue = promoDate;
            }

            if (missedPromotions.length > 0) {
                promoHistoryHTML = "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©:<ul class='promo-list'>";
                missedPromotions.forEach((date, index) => {
                    const gradeAchieved = grade - (index + 1);
                    promoHistoryHTML += `<li> Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø±Ù‚Ù… ${index + 1} (Ù„Ù„Ø¯Ø±Ø¬Ø© ${gradeAchieved >= 1 ? gradeAchieved : 1}): <i class="far fa-calendar-alt"></i> **${formatDate(date)}**</li>`;
                });
                promoHistoryHTML += "</ul>";
            } else {
                 promoHistoryHTML = "Ù„Ù… ÙŠÙ…Ø± Ø³Ù†ØªØ§Ù† Ø¹Ù„Ù‰ Ø§Ù„ØªØ®Ø±Ø¬ Ø¨Ø¹Ø¯ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ±Ù‚ÙŠØ§Øª ÙØ§Ø¦ØªØ©/Ù…Ø³ØªØ­Ù‚Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.";
            }

            dueDate = new Date(gradDate);
            dueDate.setMonth(dueDate.getMonth() + (promotionsCount + 1) * 24);

            if (promotionsCount > 0) {
                 // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©)
                const newSalaryCalc = calculateFullSalary(newGrade, newStage, degree, workType, locationAllowance, social, kids);
                newNominal = newSalaryCalc.nominal;
                newTotalSalary = newSalaryCalc.totalSalary;

                 document.getElementById("newSalaryResult").innerHTML =
                    "Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¨Ø§Ù„ØªØ³Ø±ÙŠØ¹ (Ù„Ù„Ø¯Ø±Ø¬Ø© " + newGrade + "/Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1): <span>" + newTotalSalary.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±";
                 
                 // Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ø±ÙŠ Ù„Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ style Ù…Ø¨Ø§Ø´Ø±Ø©:
                 document.getElementById("newSalaryResult").style.display = 'block'; 

                if (lastPromoDue && lastPromoDue < now) {
                     document.getElementById("overdueWarning").innerHTML = 
                        "âš ï¸ Ù…Ø³ØªØ­Ù‚ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø© " + newGrade + "ÙˆÙƒØ§Ù†Øª Ù…Ø³ØªØ­Ù‚Ø© Ø¨ØªØ§Ø±ÙŠØ® (" + formatDate(lastPromoDue) + ") ,ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±.";
                     document.getElementById("overdueWarning").classList.remove('hidden');
                }
            }
            
            document.getElementById("newGradeStage").innerHTML =
            "Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…ÙØªØ±Ø¶Ø©: <strong>" + newGrade + "</strong> (Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1)<br>" + promoHistoryHTML;

        } else { // ØªØ±Ù‚ÙŠØ© Ø¹Ø§Ø¯ÙŠØ©
            if (!lastPromo) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ±Ù‚ÙŠØ© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©.");
                return;
            }
            const requiredMonths = (grade >= 6 ? 48 : 60); 
            const promoMonths = requiredMonths - bonusMonths;
            const targetGrade = grade - 1;
            
            dueDate = new Date(lastPromo);
            dueDate.setMonth(dueDate.getMonth() + promoMonths);

            newGrade = targetGrade >= 1 ? targetGrade : 1; 
            promotionDetails = "Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ±Ù‚ÙŠØ© (Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±): <strong>" + promoMonths + "</strong>";

            if (dueDate < now) {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©)
                const newSalaryCalc = calculateFullSalary(newGrade, 1, degree, workType, locationAllowance, social, kids);
                newNominal = newSalaryCalc.nominal;
                newTotalSalary = newSalaryCalc.totalSalary;
                
                document.getElementById("newSalaryResult").innerHTML =
                    "Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ù‚ÙŠØ© (Ù„Ù„Ø¯Ø±Ø¬Ø© " + newGrade + "/Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1):** <span>" + newTotalSalary.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±";
                 
                 // Ø§Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ø±ÙŠ Ù„Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ style Ù…Ø¨Ø§Ø´Ø±Ø©:
                 document.getElementById("newSalaryResult").style.display = 'block';

                document.getElementById("overdueWarning").innerHTML = 
                    "âš ï¸ **ÙÙˆØ§Øª Ø£ÙˆØ§Ù† Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©:** Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø³ØªØ­Ù‚ Ù„Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø© **" + newGrade + "** Ø¨ØªØ§Ø±ÙŠØ® **" + formatDate(dueDate) + "**ØŒ ÙˆÙ‚Ø¯ ÙØ§Øª Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚Ù‡Ø§. **ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©** Ù„ØªØ¹Ø¯ÙŠÙ„ Ø±Ø§ØªØ¨Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© Ø£Ø¯Ù†Ø§Ù‡.";
                 document.getElementById("overdueWarning").classList.remove('hidden');
            }

             document.getElementById("newGradeStage").innerHTML =
            "Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø©: <strong>" + newGrade + "</strong>";
        }


        // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ 
        document.getElementById("salaryResult").classList.remove('hidden');
        document.getElementById("salaryResult").innerHTML =
            "Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù‚Ø¨Ù„ Ø§Ù„ØªØ±Ù‚ÙŠØ©): <span>" + currentTotalSalary.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±";
            
        document.getElementById("promoResult").classList.remove('hidden');
        document.getElementById("promoResult").innerHTML = promotionDetails;
        
        document.getElementById("newGradeStage").classList.remove('hidden');

        if (dueDate) {
             document.getElementById("dueDate").classList.remove('hidden');
             document.getElementById("dueDate").innerHTML =
            "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¯Ù… Ù„Ù„ØªØ±Ù‚ÙŠØ© :  <strong>" + formatDate(dueDate) + "</strong>";
        } 


        // 4. ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ)
        let conditionalFactorName = degree === 'diploma' ? "Ø§Ù„Ù…Ø®ØµØµØ§Øª Ø§Ù„Ø®Ø§ØµØ© (ØºÙŠØ± Ù…Ø·Ø¨Ù‚Ø©)" : "Ø§Ù„Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©";
        let certFactor = 0;
        switch (degree) {
            case 'diploma': certFactor = 0.35; break;
            case 'bachelor': certFactor = 0.45; break;
            case 'master': certFactor = 0.65; break;
            case 'phd': certFactor = 0.75; break;
            default: certFactor = 0;
        }
        let riskFactor = workType === 'field' ? 0.3 : 0.25;
        let conditionalFactor = degree === 'diploma' ? 0 : (workType === 'field' ? 0.50 : 0.35);
        let fixedOtherAllowanceFactor = 0.3;
        let totalFactors = certFactor + riskFactor + conditionalFactor + fixedOtherAllowanceFactor;
        let factoredAllowance = currentNominal * totalFactors;
        let familyAllowance = social === "married" ? (50000 + kids * 10000) : 0;
        let retirement = 0.1 * currentNominal;
        let fixedDeductions = 25000 + 4000;
        let totalDeductions = retirement + fixedDeductions;
        
        document.getElementById("detailsBox").innerHTML =
            "<h3>ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:</h3>" +
            "<strong>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø§Ø³Ù…ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> <span>" + currentNominal.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±<br>" +
            "<hr style='margin: 8px 0; border-top: 1px dashed #ccc;'>" +
            "<strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©:</strong> <span>" + (totalFactors * 100).toFixed(2) + "%</span><br>" +
            "<ul> " + 
                "<li>Ù…Ø®ØµØµ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©: " + (certFactor * 100) + "%</li>" +
                "<li>Ù…Ø®ØµØµ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: " + (riskFactor * 100) + "%</li>" +
                "<li>Ù…Ø®ØµØµØ§Øª Ø§Ø®Ø±Ù‰ : " + (fixedOtherAllowanceFactor * 100) + "%</li>" + 
                "<li>" + conditionalFactorName + ": " + (conditionalFactor * 100) + "%</li>" +
            "</ul>" +
            "<strong>Ø§Ù„Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù…ÙŠ:</strong> <span>" + factoredAllowance.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±<br>" +
            "<strong>Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø§Ø¶Ø§ÙÙŠØ©:</strong> <span>" + locationAllowance.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±<br>" +
            "<strong>Ù…Ø®ØµØµØ§Øª Ø§Ù„Ø²ÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„:</strong> <span>" + familyAllowance.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±<br>" +
            "<hr style='margin: 8px 0; border-top: 1px dashed #ccc;'>" +
            "<strong>Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©:</strong> <span>" + totalDeductions.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø± (ØªÙ‚Ø§Ø¹Ø¯: " + retirement.toLocaleString() + ")<br>" +
            "<hr style='margin: 8px 0; border-top: 1px dashed #ccc;'>" +
            "<strong>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> <span>" + currentTotalSalary.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±";

        // Ø¥Ø¸Ù‡Ø§Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        document.getElementById("detailsBox").classList.remove('hidden');
    }
    
    // Ø¯Ø§Ù„Ø© Ø­ÙØ¸ PDF Ø§Ù„Ù…Ø­Ø³Ù†Ø© (Ù…Ø¹ Ù…Ù†Ø·Ù‚ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµØ­ÙŠØ­ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù…Ø®ØµØµ)
    async function printResults() {
        if (document.getElementById("salaryResult").classList.contains('hidden') || document.getElementById("salaryResult").style.display === 'none') {
            alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ÙØ¸.");
            return;
        }

        const printBtn = document.getElementById("printBtn");
        const originalText = printBtn.innerHTML;
        printBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF...';
        printBtn.disabled = true;

        // 1. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµØºÙŠØ± Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù„Ø®Ø· Ù„ØªØ­Ø³ÙŠÙ† ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ PDF
        const targetElements = document.querySelectorAll('.result, .warning, .details');
        const originalStyles = [];
        
        targetElements.forEach(el => {
            originalStyles.push({ el: el, fontSize: el.style.fontSize });
            if (el.classList.contains('result') || el.classList.contains('warning')) {
                 el.style.fontSize = '14px'; 
            }
             if (el.classList.contains('details')) {
                 el.style.fontSize = '13px'; 
            }
             el.querySelectorAll('li').forEach(li => {
                 originalStyles.push({ el: li, fontSize: li.style.fontSize });
                 li.style.fontSize = '12px';
             });
        });

        try {
            const { jsPDF } = window.jspdf;
            const element = document.querySelector('.result-section'); 
            const grade = document.getElementById("grade").value;
            
            // =======================================================
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„ØªØ°ÙŠÙŠÙ„
            const websiteURL = 'www.s-m-c.gov.iq'; // **ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠ**
            const printDate = new Date().toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            // =======================================================
            
            // 2. Ø¥Ù†Ø´Ø§Ø¡ Canvas Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© (Scale 4)
            const canvas = await html2canvas(element, {
                scale: 4, 
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            });

            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4'); 
            pdf.setR2L(true); // Ù„Ø¶Ø¨Ø· Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± (Ù…Ù‡Ù… Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©)
            
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ø§ ÙŠØ¸Ù‡Ø± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ØŒ ÙŠØ¬Ø¨ ØªØ¶Ù…ÙŠÙ† Ø®Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§ ÙŠØ¯Ø¹Ù… jsPDF
            // pdf.setFont('Amiri-Regular', 'normal'); // Ù…Ø«Ø§Ù„ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· Ù…Ø¯Ù…Ø¬

            // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ A4
            const pdfWidth = pdf.internal.pageSize.getWidth(); // 210 mm
            const pdfHeight = pdf.internal.pageSize.getHeight(); // 297 mm
            const margin = 10;
            const headerFooterHeight = 25; // Ù…Ø³Ø§Ø­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ø±Ø£Ø³ ÙˆØ§Ù„ØªØ°ÙŠÙŠÙ„
            const availableContentHeight = pdfHeight - (2 * margin) - headerFooterHeight; 
            
            const imgContentWidth = pdfWidth - 2 * margin; 
            const imgContentHeight = (canvas.height * imgContentWidth) / canvas.width;
            
            let heightLeft = imgContentHeight;
            let currentOffset = 0; 
            let pageCount = 1;

            // 4. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ØµØ­Ø­)
            while (heightLeft > 0) {
                
                if (pageCount > 1) {
                    pdf.addPage();
                }

                let pageSliceHeight = Math.min(heightLeft, availableContentHeight);
                
                // 4.1. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰)
                // pdf.setFont('Amiri-Regular', 'normal'); 
                pdf.setFontSize(14);
                pdf.text(`ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ© - ØµÙØ­Ø© ${pageCount}`, pdfWidth / 2, margin + 5, { align: 'center' });
                
                pdf.setLineWidth(0.3);
                pdf.line(margin, margin + 8, pdfWidth - margin, pdfHeight - margin - 8);

                let startY = margin + 10; 

                // 4.2. Ø¥Ø¶Ø§ÙØ© Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ Clipping
                pdf.addGState(); 
                pdf.setClip(margin, startY, imgContentWidth, pageSliceHeight);
                
                pdf.addImage(
                    imgData, 
                    'PNG', 
                    margin, 
                    startY - currentOffset, 
                    imgContentWidth, 
                    imgContentHeight, 
                    undefined, 
                    'FAST'
                );
                
                pdf.restore(); 

                // 4.3. Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù…Ø®ØµØµ (ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„)
                pdf.setLineWidth(0.3);
                pdf.line(margin, pdfHeight - margin - 12, pdfWidth - margin, pdfHeight - margin - 12);
                
                pdf.setFontSize(8);
                
                // Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (ÙŠØ³Ø§Ø±)
                pdf.text(`Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${websiteURL}`, margin, pdfHeight - margin - 5, { align: 'left' });
                
                // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© (ÙŠÙ…ÙŠÙ†)
                pdf.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${printDate} | ØµÙØ­Ø© ${pageCount}`, pdfWidth - margin, pdfHeight - margin - 5, { align: 'right' });
                
                // 4.4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                currentOffset += pageSliceHeight; 
                heightLeft -= pageSliceHeight;
                pageCount++;
            }
            
            // 5. Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø®Ø·ÙˆØ· Ø¥Ù„Ù‰ Ø­Ø¬Ù…Ù‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
            originalStyles.forEach(item => {
                item.el.style.fontSize = item.fontSize;
            });

            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
            const timestamp = new Date().getTime();
            pdf.save(`Ø±Ø§ØªØ¨-Ø¯Ø±Ø¬Ø©${grade}-${timestamp}.pdf`);
            
            alert("âœ… ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­!");
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF:', error);
            alert("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDFØŒ Ø³ÙŠØªÙ… Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©.");
            window.print();
        } finally {
            originalStyles.forEach(item => {
                item.el.style.fontSize = item.fontSize;
            });
            printBtn.innerHTML = originalText;
            printBtn.disabled = false;
        }
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµÙÙŠØ±
    function resetForm() {
        document.getElementById("salaryForm").reset();
        document.getElementById("locationAllowance").value = 50000; 
        document.getElementById("kidsBox").classList.add('hidden');
        document.getElementById("gradBox").classList.add('hidden');
        document.querySelectorAll('.result').forEach(el => el.classList.add('hidden'));
        
        // Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø³Ø±ÙŠ Ù„Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ style Ù…Ø¨Ø§Ø´Ø±Ø©:
        document.getElementById("newSalaryResult").style.display = 'none'; 
        
        document.getElementById("detailsBox").classList.add('hidden');
        document.getElementById("overdueWarning").classList.add('hidden'); 
        alert("âœ… ØªÙ… ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„.");
    }

    // Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¨Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById("social").addEventListener('change', toggleKids);
        document.getElementById("promotionType").addEventListener('change', toggleGradDate);
        document.getElementById("calculateBtn").addEventListener('click', calculateAll);
        document.getElementById("resetBtn").addEventListener('click', resetForm);
        document.getElementById("printBtn").addEventListener('click', printResults);

        toggleKids();
        toggleGradDate();
    });
</script>

</body>
</html>
