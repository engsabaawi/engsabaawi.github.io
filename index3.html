<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§® Ù†Ø¸Ø§Ù… Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ© (Ù…Ø¹Ø¯Ù„ - Ù…Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ³Ø±ÙŠØ¹)</title>

    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary-color: #0056b3; 
            --secondary-color: #007bff; 
            --background-light: #f5f8fa;
            --background-card: #ffffff;
            --text-dark: #212529;
            --text-light: #ffffff;
            --reset-color: #dc3545;
            --warning-color: #ffc107;
            --print-color: #28a745;
            --input-height: 48px; /* Ø§Ø±ØªÙØ§Ø¹ Ù…ÙˆØ­Ø¯ Ù„Ù„Ø­Ù‚ÙˆÙ„ */
            --link-button-color: #8a2be2; /* Ù„ÙˆÙ† Ø²Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        }

        /* ØªØ·Ø¨ÙŠÙ‚ box-sizing Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            font-family: 'Rubik', sans-serif;
            background: var(--background-light);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
            direction: rtl; 
        }

        .container {
            max-width: 960px;
            margin: 30px auto;
            background: var(--background-card);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 60px);
            position: relative;
            padding-bottom: 80px;
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù€ Form-group Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Flexbox */
        .form-group {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„ØªØ³Ù…ÙŠØ© ÙˆØ§Ù„Ø­Ù‚Ù„ */
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ³Ù…ÙŠØ© (Label) */
        .form-group label {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-dark);
            /* ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„Ù„ØªØ³Ù…ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ */
            width: 35%; 
            min-width: 150px; 
            text-align: right;
            flex-shrink: 0; /* Ù…Ù†Ø¹ Ø§Ù„ØªØ³Ù…ÙŠØ© Ù…Ù† Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´ */
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙˆØ­Ø¯Ø© */
        input[type="number"],
        input[type="date"],
        select {
            /* Ø¬Ø¹Ù„ Ø§Ù„Ø­Ù‚Ù„ ÙŠÙ…Ù„Ø£ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© */
            flex-grow: 1; 
            width: 100%; 
            
            /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹ */
            height: var(--input-height); 
            padding: 0 14px; 
            font-size: 17px;
            
            border-radius: 10px;
            border: 1px solid #ced4da;
            background: #f8f9fa;
            transition: border-color 0.3s, box-shadow 0.3s;
            appearance: none; /* Ø¥Ø²Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ†Ø§Ø³Ù‚ */
            -webkit-appearance: none;
            -moz-appearance: none;
        }
        
        /* ØªØ¹Ø¯ÙŠÙ„ Ø®Ø§Øµ Ù„Ù„Ù€ select Ù„Ø¥Ø¶Ø§ÙØ© Ø³Ù‡Ù… Ù…Ø®ØµØµ */
        select {
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007bff%22%20d%3D%22M287%20197.8L146.2%2057%205.4%20197.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: left 10px center; /* ÙˆØ¶Ø¹ Ø§Ù„Ø³Ù‡Ù… Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± ÙÙŠ RTL */
            background-size: 12px 12px;
            padding-left: 30px; /* Ù„Ø¥ÙØ³Ø§Ø­ Ø§Ù„Ù…Ø¬Ø§Ù„ Ù„Ù„Ø³Ù‡Ù… */
        }


        input:focus, select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
            background: var(--background-card);
            outline: none;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ®Ø±Ø¬ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¹Ù†Ø¯ Ø¥Ø®ÙØ§Ø¦Ù‡Ù…Ø§ */
        .hidden {
            display: none !important;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-right: 35%; /* Ù…Ø­Ø§Ø°Ø§Ø© Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù„Ø­Ù‚ÙˆÙ„ */
            min-width: 400px; 
        }

        button {
            flex-grow: 1;
            padding: 16px;
            border-radius: 10px;
            border: none;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        #openPromoLink {
            background: var(--link-button-color);
            color: var(--text-light);
            font-weight: 500;
            height: var(--input-height); 
        }
        #openPromoLink:hover {
            background: #731ac7;
            transform: translateY(-2px);
        }

        button i {
            margin-left: 10px;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        #calculateBtn {
            background: var(--primary-color);
            color: var(--text-light);
        }
        #calculateBtn:hover {
            background: #004599;
            transform: translateY(-2px);
        }

        #resetBtn {
            background: var(--reset-color);
            color: var(--text-light);
        }
        #resetBtn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        #printBtn {
            background: var(--print-color);
            color: var(--text-light);
        }
        #printBtn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .result-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        /* ---------------------------------------------------- */
        /* Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù„ØªÙˆØ­ÙŠØ¯ ØªØ¨Ø§Ø¹Ø¯ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª */
        /* ---------------------------------------------------- */
        .result {
            margin-bottom: 15px; /* ØªØ¨Ø§Ø¹Ø¯ Ø«Ø§Ø¨Øª Ø£Ø³ÙÙ„ ÙƒÙ„ Ù…Ø®Ø±Ø¬ Ù†ØªÙŠØ¬Ø© */
            padding: 15px;
            background: #e9f5ff;
            border-left: 5px solid var(--secondary-color);
            border-radius: 8px;
            font-size: 18px; 
            font-weight: 500;
            color: var(--primary-color);
            margin-top: 0; /* Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù‡Ø§Ù…Ø´ Ø¹Ù„ÙˆÙŠ Ù…ÙØ±Ø· */
        }
        
        /* ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„ØªØ­Ø°ÙŠØ± Ø£ØµØ¨Ø­ Ù…ØªØ³Ø§ÙˆÙŠØ§Ù‹ (15px) */
        .warning {
            margin-top: 15px; 
            margin-bottom: 15px; 
            padding: 15px;
            background: #fff3cd;
            border-left: 5px solid var(--warning-color);
            border-radius: 8px;
            font-size: 17px; 
            font-weight: 600;
            color: #856404;
        }

        /* ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø£ØµØ¨Ø­ Ù…ØªØ³Ø§ÙˆÙŠØ§Ù‹ (15px) */
        .details {
            margin-top: 15px; /* ØªÙ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ù„ÙŠØªØ³Ø§ÙˆÙ‰ Ù…Ø¹ 15px */
            margin-bottom: 0; /* Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù‡Ø§Ù…Ø´ Ø³ÙÙ„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ùˆ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£Ø®ÙŠØ± */
            padding: 20px;
            background: #f8fafd;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            font-size: 16px; 
            color: var(--text-dark);
            line-height: 1.8;
        }
        /* ---------------------------------------------------- */
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ±Ù‚ÙŠØ© */
        .promo-result {
            background: #e6ffec; 
            border-left: 5px solid var(--print-color); 
            color: #155724; 
        }
        
        .promo-result span {
            font-weight: 700;
            color: var(--print-color);
        }

        .details strong {
            color: var(--primary-color);
            font-weight: 700;
        }

        .details span {
            font-family: 'Rubik', sans-serif;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .promo-list {
            margin-top: 10px;
            padding-right: 0;
            list-style: none;
        }
        .promo-list li {
            padding: 5px 0 5px 10px;
            border-bottom: 1px dotted #ccc;
            font-size: 16px;
        }
        .promo-list li:last-child {
            border-bottom: none;
        }
        
        .details ul {
            direction: rtl; 
            text-align: right;
            padding-right: 25px; 
            list-style-position: outside; 
            list-style-type: disc; 
        }

        .details li {
            text-align: right;
            direction: rtl;
            padding-right: 0; 
            margin-right: 0;
        }
        
        /* ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
        .footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px 35px;
            margin-top: 40px;
            border-top: 2px solid #000;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
            background: transparent;
        }

        .footer p {
            margin: 0;
            padding: 0;
        }

        .footer hr {
            border: none;
            border-top: 1px solid #000;
            margin: 0 0 15px 0;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© */
        #serviceDuration {
            background: #fff7e6; 
            border-left: 5px solid var(--warning-color);
            color: #856404;
            font-weight: 600;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ø­Ø§ÙˆÙŠØ© Ø²Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ù„ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ ØªÙ†Ø³ÙŠÙ‚ form-group */
        #promoLinkBox {
            /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ù„ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø¹Ø±Ø¶ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
            flex-grow: 1; 
            width: 100%; 
        }


        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„ØªØµØ§Ù…ÙŠÙ… Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .container { margin: 15px; padding: 25px; padding-bottom: 70px; border-radius: 15px; }
            h2 { font-size: 28px; margin-bottom: 20px; }
            
            /* ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©: ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ù…Ù† Ø£ÙÙ‚ÙŠØ© Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© */
            .form-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .form-group label {
                width: 100%; 
                text-align: right;
                margin-bottom: 5px;
            }
            input[type="number"],
            input[type="date"],
            select {
                width: 100%; 
            }
            .btn-group { 
                flex-direction: column; 
                gap: 10px;
                padding-right: 0; 
                min-width: auto;
            }
            button { font-size: 17px; padding: 14px; }
            .result { font-size: 17px; padding: 14px; }
            .details { font-size: 15px; padding: 15px; }
            .footer { padding: 15px 25px; }
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© ÙƒØ§Ø­ØªÙŠØ§Ø·ÙŠ */
        @media print {
            body { background: white; }
            .container { 
                box-shadow: none; 
                margin: 0; 
                padding: 0;
                max-width: 100%;
            }
            /* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø±Ø£Ø³ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
            .form-group, .btn-group, h2 { display: none !important; }
            .result-section { border-top: none; padding-top: 0; }
            .result, .warning, .details {
                page-break-inside: avoid;
                border: 1px solid #333 !important;
                background: #f9f9f9 !important;
                padding: 10px !important;
                margin-bottom: 10px !important;
            }
            .details ul { 
                padding-right: 25px !important; 
                direction: rtl !important; 
                text-align: right !important;
                list-style-position: outside !important;
            }
            .details li {
                direction: rtl !important; 
                text-align: right !important;
            }
            .promo-list { list-style: none; padding-right: 0; }
            .footer { 
                display: block !important;
                position: relative !important;
                border-top: 2px solid #000 !important;
                padding: 15px !important;
                margin-top: 20px !important;
            }
        }
    </style>
</head>
<body>

<div class="container">

    <h2><i class="fas fa-calculator"></i> Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ©</h2>

    <form id="salaryForm">
        <div class="form-group">
            <label for="dateOfAppointment">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label>
            <input type="date" id="dateOfAppointment" name="dateOfAppointment">
        </div>

        <div class="form-group">
            <label for="degreeType">Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</label>
            <select id="degreeType" name="degreeType">
                <option value="diploma">Ø¯Ø¨Ù„ÙˆÙ…</option>
                <option value="bachelor" selected>Ø¨ÙƒÙ„ÙˆØ±ÙŠÙˆØ³</option>
                <option value="master">Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                <option value="phd">Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="workType">ØªØµÙ†ÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙØ©</label>
            <select id="workType" name="workType">
                <option value="field" selected>Ù…ÙŠØ¯Ø§Ù†ÙŠ</option>
                <option value="admin">Ø¥Ø¯Ø§Ø±ÙŠ</option>
            </select>
        </div>

        <div class="form-group">
            <label for="grade">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
            <select id="grade" name="grade">
                <option value="8" selected>8</option>
                <option value="7">7</option>
                <option value="6">6</option>
                <option value="5">5</option>
                <option value="4">4</option>
                <option value="3">3</option>
                <option value="2">2</option>
                <option value="1">1</option>
            </select>
        </div>

        <div class="form-group">
            <label for="stage">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
            <select id="stage" name="stage">
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
            </select>
        </div>

        <div class="form-group">
            <label for="locationAllowance">Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ / Ø§Ù„Ø¥Ù‚Ø§Ù…Ø© (Ø¯ÙŠÙ†Ø§Ø±)</label>
            <input type="number" id="locationAllowance" name="locationAllowance" value="50000" min="0">
        </div>

        <div class="form-group">
            <label for="lastPromotion">ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ±Ù‚ÙŠØ©</label>
            <input type="date" id="lastPromotion" name="lastPromotion">
        </div>

        <div class="form-group">
            <label for="promotionType">Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ù‚ÙŠØ©</label>
            <select id="promotionType" name="promotionType">
                <option value="normal" selected>ØªØ±Ù‚ÙŠØ© Ø¹Ø§Ø¯ÙŠØ©</option>
                <option value="fast">Ù…Ø´Ù…ÙˆÙ„ Ø¨Ø§Ù„ØªØ³Ø±ÙŠØ¹ (Ù†Ø¸Ø§Ù… Ø®Ø§Ø±Ø¬ÙŠ)</option>
            </select>
        </div>
        
        <div id="promoLinkBox" class="form-group hidden">
            <label for="openPromoLink">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø±ÙŠØ¹</label>
            <button type="button" id="openPromoLink">
                 <i class="fas fa-external-link-alt"></i> ÙØªØ­ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù…Ø®ØµØµ
            </button>
        </div>

        <div class="form-group">
            <label for="social">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</label>
            <select id="social" name="social">
                <option value="single" selected>Ø£Ø¹Ø²Ø¨</option>
                <option value="married">Ù…ØªØ²ÙˆØ¬</option>
            </select>
        </div>

        <div id="kidsBox" class="form-group hidden">
            <label for="kids">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·ÙØ§Ù„</label>
            <select id="kids" name="kids">
                <option value="0" selected>0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>

        <div class="form-group">
            <label for="bonusMonths">Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„Ù‚Ø¯Ù… (ÙƒØªØ¨ Ø§Ù„Ø´ÙƒØ±)</label>
            <input type="number" id="bonusMonths" name="bonusMonths" value="0" min="0">
        </div>

        <div class="btn-group">
            <button type="button" id="calculateBtn"><i class="fas fa-hand-holding-usd"></i> Ø§Ø­Ø³Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button type="button" id="resetBtn"><i class="fas fa-redo-alt"></i> ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
            <button type="button" id="printBtn"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©/Ø­ÙØ¸ PDF</button>
        </div>
    </form>

    <div class="result-section">
        <div id="salaryResult" class="result hidden"></div>
        <div id="promoResult" class="result hidden"></div>
        <div id="newGradeStage" class="result hidden"></div>
        <div id="dueDate" class="result hidden"></div>
        <div id="overdueWarning" class="warning hidden"></div> 
        <div id="newSalaryResult" class="result promo-result" style="display: none;"></div> 
        <div id="serviceDuration" class="result hidden"></div>
        <div id="detailsBox" class="details hidden"></div>
    </div>

    <div class="footer">
        <hr>
        <p>Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… - Ù…Ø§Ù„Ùƒ Ù…Ø­Ù…Ø¯ - Ø´Ø±ÙƒØ© Ù…ØµØ§ÙÙŠ Ø§Ù„Ø¬Ù†ÙˆØ¨</p>
    </div>

</div>

<script>
    // Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø±Ø§ØªØ¨
    const gradeBase = { 8: 260000, 7: 296000, 6: 362000, 5: 429000, 4: 509000, 3: 600000, 2: 723000, 1: 910000 };
    const stageAddLogic = (grade) => {
        const defaultAdd = { 8: 3000, 7: 6000, 6: 6000, 5: 6000, 4: 8000, 3: 10000, 2: 17000, 1: 20000 };
        return defaultAdd[grade] || 0;
    };
    
    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const DEDUCTIONS = {
        HEALTH_INSURANCE: 25000, // Ø¶Ù…Ø§Ù† ØµØ­ÙŠ
        SOCIAL_SOLIDARITY: 2000, // ØªÙƒØ§ÙÙ„ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ
        CHILD_HOSPITAL_SUPPORT: 1000, // Ø¯Ø¹Ù… Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø·ÙÙ„
        PREVIOUS_DEDUCTION: 1000 // Ù…Ø§ Ù‚Ø¨Ù„Ù‡
    };
    
    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø£ÙŠ Ø¯Ø±Ø¬Ø© ÙˆÙ…Ø±Ø­Ù„Ø© Ù…Ø­Ø¯Ø¯Ø©
    function calculateFullSalary(targetGrade, targetStage, degree, workType, locationAllowance, social, kids) {
        // 1. Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø§Ø³Ù…ÙŠ
        const nominal = gradeBase[targetGrade] + ((targetStage - 1) * stageAddLogic(targetGrade));

        // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
        let certFactor;
        switch (degree) {
            case 'diploma': certFactor = 0.35; break;
            case 'bachelor': certFactor = 0.45; break;
            case 'master': certFactor = 0.65; break;
            case 'phd': certFactor = 0.75; break;
            default: certFactor = 0;
        }

        const riskFactor = workType === 'field' ? 0.3 : 0.25;
        
        let conditionalFactor = 0; 
        
        if (degree !== 'diploma') {
            conditionalFactor = workType === 'field' ? 0.50 : 0.35;
        }
        
        const fixedOtherAllowanceFactor = 0.3; 

        const totalFactors = certFactor + riskFactor + conditionalFactor + fixedOtherAllowanceFactor;
        const factoredAllowance = nominal * totalFactors; 

        // 3. Ù…Ø®ØµØµØ§Øª Ø§Ù„Ø²ÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„
        let familyAllowance = 0;
        if (social === "married") {
            familyAllowance = 50000 + kids * 10000; 
        }
        
        // 4. Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹Ø§Øª
        const retirement = Math.round(0.1 * nominal); // ØªÙ‚Ø§Ø¹Ø¯ (10% Ù…Ù† Ø§Ù„Ø§Ø³Ù…ÙŠ)
        const fixedDeductions = DEDUCTIONS.HEALTH_INSURANCE + DEDUCTIONS.SOCIAL_SOLIDARITY + DEDUCTIONS.CHILD_HOSPITAL_SUPPORT + DEDUCTIONS.PREVIOUS_DEDUCTION;
        const totalDeductions = retirement + fixedDeductions;
        
        // 5. Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ
        const totalSalary = Math.round((nominal + factoredAllowance + locationAllowance + familyAllowance) - totalDeductions);
        
        return { nominal, totalSalary };
    }

    // Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ø¨Ø¯Ù‚Ø©
    function calculateServiceDuration(startDate) {
        if (!startDate) return null;
        
        const start = new Date(startDate);
        const now = new Date();

        let years = now.getFullYear() - start.getFullYear();
        let months = now.getMonth() - start.getMonth();
        let days = now.getDate() - start.getDate();

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙŠØ§Ù…
        if (days < 0) {
            months--;
            // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ (Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ)
            const daysInPreviousMonth = new Date(now.getFullYear(), now.getMonth(), 0).getDate();
            days += daysInPreviousMonth;
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø´Ù‡Ø±
        if (months < 0) {
            years--;
            months += 12;
        }
        
        if (years < 0) {
            // Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ØŒ ÙˆÙ‡Ùˆ Ø®Ø·Ø£ Ù…Ù†Ø·Ù‚ÙŠ
            return "ØªØ§Ø±ÙŠØ® ØªØ¹ÙŠÙŠÙ† ØºÙŠØ± ØµØ­ÙŠØ­"; 
        }

        return { years, months, days };
    }


    // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„
    function toggleKids() {
        document.getElementById("kidsBox").classList.toggle(
            "hidden",
            document.getElementById("social").value !== "married"
        );
    }
    
    function togglePromoLink() {
        // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± "fast"
        document.getElementById("promoLinkBox").classList.toggle(
            "hidden",
            document.getElementById("promotionType").value !== "fast"
        );
        
        // ÙÙŠ Ø­Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ³Ø±ÙŠØ¹ØŒ ÙŠØ¬Ø¨ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø£Ù†Ù‡ Ù„Ù† ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ù‚ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù…
        if (document.getElementById("promotionType").value === "fast") {
            document.getElementById("promoResult").classList.remove('hidden');
            document.getElementById("promoResult").innerHTML = 
                "âš ï¸ **ØªÙ†Ø¨ÙŠÙ‡:** Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± 'Ù…Ø´Ù…ÙˆÙ„ Ø¨Ø§Ù„ØªØ³Ø±ÙŠØ¹'ØŒ ÙŠØªÙ… ÙÙ‚Ø· Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ. ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… **Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù…Ø®ØµØµ** Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¯Ø±Ø¬Ø© ÙˆØ§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.";
        } else {
             document.getElementById("promoResult").classList.add('hidden');
        }
    }

    // Ø¯Ø§Ù„Ø© ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø®ØµØµ (Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ Ø³ÙŠØ­Ø¯Ø¯Ù‡ Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    function openCustomPromoSystem() {
        const customLink = "https://engsabaawi.github.io/index2.html"; // <<=== ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù‡Ù†Ø§
        
        if (customLink.includes("https://engsabaawi.github.io/index2.html")) {
            window.open(customLink, '_blank');
        } else {
            alert("âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø®ØµØµ ØºÙŠØ± ØµØ­ÙŠØ­. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ©.");
        }
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
    function formatDate(date) {
        return date.toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    function calculateAll() {
        // Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ø®ÙØ§Ø¡
        document.querySelectorAll('.result').forEach(el => el.classList.add('hidden'));
        document.getElementById("detailsBox").classList.add('hidden');
        document.getElementById("overdueWarning").classList.add('hidden'); 
        
        // Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø³Ø±ÙŠ Ù„Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ style Ù…Ø¨Ø§Ø´Ø±Ø©
        document.getElementById("newSalaryResult").style.display = 'none';

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
        const dateOfAppointment = document.getElementById("dateOfAppointment").value;
        const grade = parseInt(document.getElementById("grade").value);
        const stage = parseInt(document.getElementById("stage").value);
        const degree = document.getElementById("degreeType").value; 
        const workType = document.getElementById("workType").value;   
        const locationAllowance = parseInt(document.getElementById("locationAllowance").value) || 0; 
        const social = document.getElementById("social").value;
        const kids = parseInt(document.getElementById("kids").value) || 0;
        const promoType = document.getElementById("promotionType").value;
        const lastPromo = document.getElementById("lastPromotion").value ? new Date(document.getElementById("lastPromotion").value) : null;
        const bonusMonths = parseInt(document.getElementById("bonusMonths").value) || 0;
        const now = new Date();
        
        
        // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
        const { nominal: currentNominal, totalSalary: currentTotalSalary } = 
            calculateFullSalary(grade, stage, degree, workType, locationAllowance, social, kids);
            
        document.getElementById("salaryResult").classList.remove('hidden');
        document.getElementById("salaryResult").innerHTML =
            "Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ: <span>" + currentTotalSalary.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±";

        // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ (ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ù‚ÙŠØ© "Ø¹Ø§Ø¯ÙŠ")
        if (promoType === 'normal') {
             // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø§Ù„Ø°ÙŠ ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¤Ù‡ ÙÙŠ Ø­Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ³Ø±ÙŠØ¹ 
            document.getElementById("promoResult").classList.add('hidden'); 
            
            if (!lastPromo) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ±Ù‚ÙŠØ© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©.");
                return;
            }
            
            // Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©: 4 Ø³Ù†ÙˆØ§Øª (48 Ø´Ù‡Ø±) Ù„Ù„Ø¯Ø±Ø¬Ø§Øª 6 ÙÙ…Ø§ ÙÙˆÙ‚ØŒ Ùˆ 5 Ø³Ù†ÙˆØ§Øª (60 Ø´Ù‡Ø±) Ù„Ù„Ø¯Ø±Ø¬Ø§Øª 7 ÙÙ…Ø§ Ø¯ÙˆÙ†
            const requiredMonths = (grade <= 6 ? 48 : 60); 
            const promoMonths = requiredMonths - bonusMonths;
            const targetGrade = grade - 1;
            
            let dueDate = new Date(lastPromo);
            dueDate.setMonth(dueDate.getMonth() + promoMonths);

            let newGrade = targetGrade >= 1 ? targetGrade : 1; 
            
            let promotionDetails = "";
            let promoTargetText = "";
            let calcGrade = newGrade;
            let calcStage = 1;

            if (newGrade === grade) { // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù‡ÙŠ 1ØŒ ÙØ³ØªÙƒÙˆÙ† Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ø±Ø­Ù„Ø©
                 promotionDetails = "Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ù…Ø±Ø­Ù„Ø© (Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±): <strong>" + promoMonths + "</strong>";
                 promoTargetText = `Ø§Ù„Ù…Ø±Ø­Ù„Ø© ${stage + 1} (Ø§Ù„Ø¯Ø±Ø¬Ø© ${grade})`;
                 calcGrade = grade;
                 calcStage = stage + 1;
            } else {
                 promotionDetails = "Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø© " + newGrade + " (Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±): <strong>" + promoMonths + "</strong>";
                 promoTargetText = `Ø§Ù„Ø¯Ø±Ø¬Ø© ${newGrade}/Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1`;
            }
            
            document.getElementById("promoResult").classList.remove('hidden');
            document.getElementById("promoResult").innerHTML = promotionDetails;

            document.getElementById("newGradeStage").classList.remove('hidden');
            document.getElementById("newGradeStage").innerHTML = `Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ø¥Ù„Ù‰: <strong>${promoTargetText}</strong>`;
            
            document.getElementById("dueDate").classList.remove('hidden');
            document.getElementById("dueDate").innerHTML =
                "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¯Ù… Ù„Ù„ØªØ±Ù‚ÙŠØ© :  <strong>" + formatDate(dueDate) + "</strong>";


            if (dueDate <= now) { // ØªÙ…Øª Ø§Ù„Ù…Ø³Ø§ÙˆØ§Ø© Ù„ØªØ´Ù…Ù„ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ…
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©)
                const newSalaryCalc = calculateFullSalary(calcGrade, calcStage, degree, workType, locationAllowance, social, kids);
                const newTotalSalary = newSalaryCalc.totalSalary;
                
                document.getElementById("newSalaryResult").innerHTML =
                    `Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±Ù‚ÙŠØ© (${promoTargetText}):** <span>${newTotalSalary.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±`;
                 
                 document.getElementById("newSalaryResult").style.display = 'block';

                document.getElementById("overdueWarning").innerHTML = 
                    "âš ï¸ **ÙÙˆØ§Øª Ø£ÙˆØ§Ù† Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©:** Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ø³ØªØ­Ù‚ Ù„Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ " + promoTargetText + " Ø¨ØªØ§Ø±ÙŠØ® **" + formatDate(dueDate) + "**ØŒ ÙˆÙ‚Ø¯ ÙØ§Øª Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªØ­Ù‚Ø§Ù‚Ù‡Ø§. **ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©**.";
                 document.getElementById("overdueWarning").classList.remove('hidden');
            }
        }


        // 0. Ø­Ø³Ø§Ø¨ Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ¹Ø±Ø¶Ù‡Ø§
        const service = calculateServiceDuration(dateOfAppointment);
        const serviceElement = document.getElementById("serviceDuration");
        
        if (service && typeof service !== 'string') {
            serviceElement.innerHTML = 
                `Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©: 
                (${service.years}) Ø³Ù†Ø©Ùˆ 
                (${service.months}) Ø´Ù‡Ø±Ùˆ 
                (${service.days}) ÙŠÙˆÙ….`;
            serviceElement.classList.remove('hidden');
        } else if (typeof service === 'string') {
            alert(service); // ØªÙ†Ø¨ÙŠÙ‡ ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ø®Ø·Ø£ Ù…Ù†Ø·Ù‚ÙŠ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®
        }


        // 4. ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ)
        let conditionalFactorName = degree === 'diploma' ? "Ø§Ù„Ù…Ø®ØµØµØ§Øª Ø§Ù„Ø®Ø§ØµØ©" : "Ø§Ù„Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©/Ø§Ù„Ø¹Ù„Ù…ÙŠØ©";
        
        let certFactor = 0;
        switch (degree) {
            case 'diploma': certFactor = 0.35; break;
            case 'bachelor': certFactor = 0.45; break;
            case 'master': certFactor = 0.65; break;
            case 'phd': certFactor = 0.75; break;
            default: certFactor = 0;
        }
        let riskFactor = workType === 'field' ? 0.3 : 0.25;
        let conditionalFactor = degree === 'diploma' ? 0 : (workType === 'field' ? 0.50 : 0.35);
        let fixedOtherAllowanceFactor = 0.3;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù†Ø³Ø¨
        const certAmount = Math.round(currentNominal * certFactor);
        const riskAmount = Math.round(currentNominal * riskFactor);
        const otherFixedAmount = Math.round(currentNominal * fixedOtherAllowanceFactor);
        const conditionalAmount = Math.round(currentNominal * conditionalFactor);
        
        // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù…ÙŠ
        let factoredAllowance = certAmount + riskAmount + conditionalAmount + otherFixedAmount;

        let familyAllowance = social === "married" ? (50000 + kids * 10000) : 0;
        let retirement = Math.round(0.1 * currentNominal);
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø«Ø§Ø¨ØªØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const fixedDeductions = DEDUCTIONS.HEALTH_INSURANCE + DEDUCTIONS.SOCIAL_SOLIDARITY + DEDUCTIONS.CHILD_HOSPITAL_SUPPORT + DEDUCTIONS.PREVIOUS_DEDUCTION;
        const totalDeductions = retirement + fixedDeductions;
        
        // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®ØµØµØ§Øª (Ø§Ù„Ø§Ø³Ù…ÙŠ + Ø§Ù„Ø²ÙˆØ¬ÙŠØ© + Ø§Ù„Ù…ÙˆÙ‚Ø¹ÙŠØ©)
        const totalAllowances = factoredAllowance + locationAllowance + familyAllowance;


        document.getElementById("detailsBox").innerHTML =
            "<h3>ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:</h3>" +
            "<strong>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø§Ø³Ù…ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> <span>" + currentNominal.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±<br>" +
            "<hr style='margin: 8px 0; border-top: 1px dashed #ccc;'>" +
            "<h4>â• Ø§Ù„Ù…Ø®ØµØµØ§Øª (Ø¨Ø§Ù„Ù…Ø¨Ø§Ù„Øº):</h4>" +
            "<ul> " + 
                `<li>Ù…Ø®ØµØµØ§Øª Ø´Ù‡Ø§Ø¯Ø© (${(certFactor * 100).toFixed(0)}%): <span>${certAmount.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
                `<li>Ù…Ø®ØµØµØ§Øª Ø®Ø·ÙˆØ±Ø© (${(riskFactor * 100).toFixed(0)}%): <span>${riskAmount.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
                `<li>Ù…Ø®ØµØµØ§Øª Ø§Ø®Ø±Ù‰ Ø«Ø§Ø¨ØªØ© (${(fixedOtherAllowanceFactor * 100).toFixed(0)}%): <span>${otherFixedAmount.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` + 
                `<li>${conditionalFactorName} (${(conditionalFactor * 100).toFixed(0)}%): <span>${conditionalAmount.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
                `<li>Ù…Ø®ØµØµØ§Øª Ø§Ù„Ø²ÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ø£Ø·ÙØ§Ù„: <span>${familyAllowance.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
                `<li>Ù…Ø®ØµØµØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ / Ø³Ø§Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ù…ÙˆÙ‚Ø¹ÙŠØ©): <span>${locationAllowance.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
            "</ul>" +
            "<hr style='margin: 8px 0; border-top: 1px dashed #ccc;'>" +
            "<strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®ØµØµØ§Øª Ø§Ù„ÙƒÙ„ÙŠ:</strong> <span>" + totalAllowances.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±<br>" + 
            "<hr style='margin: 8px 0; border-top: 1px dashed #ccc;'>" +
            "<h4>â– Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹Ø§Øª:</h4>" +
            "<ul> " + 
                `<li>ØªÙ‚Ø§Ø¹Ø¯ (10% Ù…Ù† Ø§Ù„Ø§Ø³Ù…ÙŠ): <span>${retirement.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
                `<li>Ø¶Ù…Ø§Ù† ØµØ­ÙŠ: <span>${DEDUCTIONS.HEALTH_INSURANCE.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
                `<li>ØªÙƒØ§ÙÙ„ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ: <span>${DEDUCTIONS.SOCIAL_SOLIDARITY.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
                `<li>Ø¯Ø¹Ù… Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø·ÙÙ„: <span>${DEDUCTIONS.CHILD_HOSPITAL_SUPPORT.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
                `<li>Ù…Ø§ Ù‚Ø¨Ù„Ù‡: <span>${DEDUCTIONS.PREVIOUS_DEDUCTION.toLocaleString()}</span> Ø¯ÙŠÙ†Ø§Ø±</li>` +
            "</ul>" +
            "<hr style='margin: 8px 0; border-top: 1px dashed #ccc;'>" +
            "<strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„ÙƒÙ„ÙŠ:</strong> <span>" + totalDeductions.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±<br>" +
            "<hr style='margin: 8px 0; border-top: 1px dashed #ccc;'>" +
            "<strong>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> <span>" + currentTotalSalary.toLocaleString() + "</span> Ø¯ÙŠÙ†Ø§Ø±";

        // Ø¥Ø¸Ù‡Ø§Ø± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        document.getElementById("detailsBox").classList.remove('hidden');
    }
    
    // Ø¯Ø§Ù„Ø© Ø­ÙØ¸ PDF Ø§Ù„Ù…Ø­Ø³Ù†Ø© 
    async function printResults() {
        if (document.getElementById("salaryResult").classList.contains('hidden') || document.getElementById("salaryResult").style.display === 'none') {
            alert("âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ÙØ¸.");
            return;
        }

        const printBtn = document.getElementById("printBtn");
        const originalText = printBtn.innerHTML;
        printBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF...';
        printBtn.disabled = true;

        // 1. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµØºÙŠØ± Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ù„Ø®Ø· Ù„ØªØ­Ø³ÙŠÙ† ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ PDF
        const targetElements = document.querySelectorAll('.result, .warning, .details');
        const originalStyles = [];
        
        targetElements.forEach(el => {
            originalStyles.push({ el: el, fontSize: el.style.fontSize });
            if (el.classList.contains('result') || el.classList.contains('warning')) {
                 el.style.fontSize = '14px'; 
            }
             if (el.classList.contains('details')) {
                 el.style.fontSize = '13px'; 
            }
             el.querySelectorAll('li').forEach(li => {
                 originalStyles.push({ el: li, fontSize: li.style.fontSize });
                 li.style.fontSize = '12px';
             });
        });

        try {
            const { jsPDF } = window.jspdf;
            const element = document.querySelector('.result-section'); 
            const grade = document.getElementById("grade").value;
            
            // =======================================================
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„ØªØ°ÙŠÙŠÙ„
            const websiteURL = 'www.s-m-c.gov.iq'; // **ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠ**
            const printDate = new Date().toLocaleDateString('ar-EG', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            // =======================================================
            
            // 2. Ø¥Ù†Ø´Ø§Ø¡ Canvas Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© (Scale 4)
            const canvas = await html2canvas(element, {
                scale: 4, 
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            });

            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4'); 
            pdf.setR2L(true); // Ù„Ø¶Ø¨Ø· Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± (Ù…Ù‡Ù… Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©)
            
            // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ A4
            const pdfWidth = pdf.internal.pageSize.getWidth(); // 210 mm
            const pdfHeight = pdf.internal.pageSize.getHeight(); // 297 mm
            const margin = 10;
            const headerFooterHeight = 25; // Ù…Ø³Ø§Ø­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ø±Ø£Ø³ ÙˆØ§Ù„ØªØ°ÙŠÙŠÙ„
            const availableContentHeight = pdfHeight - (2 * margin) - headerFooterHeight; 
            
            const imgContentWidth = pdfWidth - 2 * margin; 
            const imgContentHeight = (canvas.height * imgContentWidth) / canvas.width;
            
            let heightLeft = imgContentHeight;
            let currentOffset = 0; 
            let pageCount = 1;

            // 4. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ØµØ­Ø­)
            while (heightLeft > 0) {
                
                if (pageCount > 1) {
                    pdf.addPage();
                }

                let pageSliceHeight = Math.min(heightLeft, availableContentHeight);
                
                // 4.1. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰)
                pdf.setFontSize(14);
                pdf.text(`ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±Ø§ØªØ¨ ÙˆØ§Ù„ØªØ±Ù‚ÙŠØ© - ØµÙØ­Ø© ${pageCount}`, pdfWidth / 2, margin + 5, { align: 'center' });
                
                pdf.setLineWidth(0.3);
                pdf.line(margin, margin + 8, pdfWidth - margin, pdfHeight - margin - 8);

                let startY = margin + 10; 

                // 4.2. Ø¥Ø¶Ø§ÙØ© Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ Clipping
                pdf.addGState(); 
                pdf.setClip(margin, startY, imgContentWidth, pageSliceHeight);
                
                pdf.addImage(
                    imgData, 
                    'PNG', 
                    margin, 
                    startY - currentOffset, 
                    imgContentWidth, 
                    imgContentHeight, 
                    undefined, 
                    'FAST'
                );
                
                pdf.restore(); 

                // 4.3. Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø§Ù„Ù…Ø®ØµØµ (ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„)
                pdf.setLineWidth(0.3);
                pdf.line(margin, pdfHeight - margin - 12, pdfWidth - margin, pdfHeight - margin - 12);
                
                pdf.setFontSize(8);
                
                // Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (ÙŠØ³Ø§Ø±)
                pdf.text(`Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${websiteURL}`, margin, pdfHeight - margin - 5, { align: 'left' });
                
                // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© (ÙŠÙ…ÙŠÙ†)
                pdf.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${printDate} | ØµÙØ­Ø© ${pageCount}`, pdfWidth - margin, pdfHeight - margin - 5, { align: 'right' });
                
                // 4.4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                currentOffset += pageSliceHeight; 
                heightLeft -= pageSliceHeight;
                pageCount++;
            }
            
            // 5. Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø®Ø·ÙˆØ· Ø¥Ù„Ù‰ Ø­Ø¬Ù…Ù‡Ø§ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
            originalStyles.forEach(item => {
                item.el.style.fontSize = item.fontSize;
            });

            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù
            const timestamp = new Date().getTime();
            pdf.save(`Ø±Ø§ØªØ¨-Ø¯Ø±Ø¬Ø©${grade}-${timestamp}.pdf`);
            
            alert("âœ… ØªÙ… Ø­ÙØ¸ Ù…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­!");
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF:', error);
            alert("âœ… ØªÙ…Øª Ø¨Ù†Ø¬Ø§Ø­ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ø¶ØºØ· Ø§ØºÙ„Ø§Ù‚");
            window.print();
        } finally {
            originalStyles.forEach(item => {
                item.el.style.fontSize = item.fontSize;
            });
            printBtn.innerHTML = originalText;
            printBtn.disabled = false;
        }
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµÙÙŠØ±
    function resetForm() {
        document.getElementById("salaryForm").reset();
        document.getElementById("locationAllowance").value = 50000; 
        document.getElementById("kidsBox").classList.add('hidden');
        document.getElementById("promoLinkBox").classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø±Ø§Ø¨Ø·
        document.querySelectorAll('.result').forEach(el => el.classList.add('hidden'));
        
        // Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø³Ø±ÙŠ Ù„Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ style Ù…Ø¨Ø§Ø´Ø±Ø©:
        document.getElementById("newSalaryResult").style.display = 'none'; 
        
        document.getElementById("detailsBox").classList.add('hidden');
        document.getElementById("overdueWarning").classList.add('hidden'); 
        alert("âœ… ØªÙ… ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„.");
    }

    // Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¨Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById("social").addEventListener('change', toggleKids);
        document.getElementById("promotionType").addEventListener('change', togglePromoLink);
        document.getElementById("calculateBtn").addEventListener('click', calculateAll);
        document.getElementById("resetBtn").addEventListener('click', resetForm);
        document.getElementById("printBtn").addEventListener('click', printResults);
        document.getElementById("openPromoLink").addEventListener('click', openCustomPromoSystem);

        toggleKids();
        togglePromoLink(); // Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ù„Ù„Ø²Ø±
    });
</script>

</body>
</html>
